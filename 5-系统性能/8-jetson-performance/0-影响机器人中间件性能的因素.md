# ROS2概述

![](https://tcs.teambition.net/storage/312j580eb0e0121369cf82bf91c6a50908ef?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmo1ODBlYjBlMDEyMTM2OWNmODJiZjkxYzZhNTA5MDhlZiJ9.p7gsGuSqLTci0OaasSgCe7bfzwMKcgD9GZOFDSTdIJY&download=image.png "")

![](https://tcs.teambition.net/storage/312j40fd13ef4125f9c9ae3dedd6d629da1c?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmo0MGZkMTNlZjQxMjVmOWM5YWUzZGVkZDZkNjI5ZGExYyJ9.EXuB1krUQrYtAc7VlX3SVUN0m8zG1VM1bZpafcKUvwM&download=image.png "")

![](https://tcs.teambition.net/storage/312j0c1c976c4fc0b5e59fe6579a4c346503?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmowYzFjOTc2YzRmYzBiNWU1OWZlNjU3OWE0YzM0NjUwMyJ9.EaDU_YRCwNATrhXO2ynKniAvHmqWVuwylQ0umBHc9yo&download=image.png "")

# 性能需求

## 时延需求

人类反应时间是100ms，算法计算时间是10ms

传输时延应该比算法计算时间少一个数量级，即10%，1ms

1ms is one order of magnitude lower than the running time of commonly used AD algorithms, and two orders of magnitude lower than the fastest human driver’s re-action time (100ms end-to-end latency)

## 吞吐量需求

![](https://tcs.teambition.net/storage/312j3ba4336f820f78f451a90d3d0839cc5d?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmozYmE0MzM2ZjgyMGY3OGY0NTFhOTBkM2QwODM5Y2M1ZCJ9.vCeQP6jVg0bO2D40UASb0Mv0r8DvVNESUCkd8ZpQbrU&download=image.png "")

# ROS2时延概念

## 时延分段

![](https://tcs.teambition.net/storage/312j51213158a601f749ac3b79c480a3b738?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmo1MTIxMzE1OGE2MDFmNzQ5YWMzYjc5YzQ4MGEzYjczOCJ9.2nUcYaJZA-lSxjCb--Ew8p46IbZeXmgtBK1Lp3ElsU8&download=image.png "")

## 时延分类

![](https://tcs.teambition.net/storage/312h9364add0fd5a8dce16931b3d56424c85?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmg5MzY0YWRkMGZkNWE4ZGNlMTY5MzFiM2Q1NjQyNGM4NSJ9.YP8Y8hjp6i7DDcfbePcIJWqcEYYUQ23s1yKP0cZhqvg&download=image.png "")

# 应用开发对性能影响

## rclcpp性能占用

ros2_tracing:

对于直接使用dds，使用rclcpp的传输时延会多50%，即rclcpp开销是dds开销一半左右

消息类型越复杂，串行化速度越慢，传输开销就越大

数据大小越大，dds占用的开销就越大

## 数据发布频率对性能影响

发布频率对时延基本无影响，事实上频率越高，时延越低，这也许跟调度机制有关

By comparing scenarios (Fig.2 (b) and (c)) with different

frequencies and the same message size, we can see that the

publishing frequency is not an essential factor in transmission

latency. [13] even found that latency decreases with increasing

frequency, which might be due to energy-saving features or

scheduling scheme.

## 数据大小对时延影响

明显影响，数据越大，时延越大

![](https://tcs.teambition.net/storage/312j19126ccd24f55fd01067aba24707ea9b?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmoxOTEyNmNjZDI0ZjU1ZmQwMTA2N2FiYTI0NzA3ZWE5YiJ9.WEXhu4NeYuW51172-2417me4Nnc4OO3IBx9UjhiEMhI&download=image.png "")

the data copy and serialization/deserialization operations are the major sources of communication overhead.

## 数据传输场景

## 1-N场景

the Lidar data could be used for avoiding obstacles, building HD map and localization [35] respectively.

进程内通信，在1-N的场景下，性能会下降。

![](https://tcs.teambition.net/storage/312jda97acf074ae510ea9ba4bddcca4a968?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmpkYTk3YWNmMDc0YWU1MTBlYTliYTRiZGRjY2E0YTk2OCJ9.2Ukp_yPnWHlCtuBSYvXZcjd9w3213ijyhL8FcPXFC58&download=image.png "")

![](https://tcs.teambition.net/storage/312jae06679561b02c29ae9d886e866af0b0?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmphZTA2Njc5NTYxYjAyYzI5YWU5ZDg4NmU4NjZhZjBiMCJ9.yYk1AOup9NS6hC_y-w2ahu3okN-IkutN0zvUAGnGN9U&download=image.png "")

但是使用dds的SHM传输方式则不会有强烈的性能退化

![](https://tcs.teambition.net/storage/312j99d306e1e209de6f5c87935fd87a2044?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmo5OWQzMDZlMWUyMDlkZTZmNWM4NzkzNWZkODdhMjA0NCJ9.5_A4P2PRxvB08vFbZ1uuLWgZRUeFg1YBalm_37Q9a3U&download=image.png "")

1-N场景下，TCP传输方式有较大性能开销

![](https://tcs.teambition.net/storage/312jc1ac032c8012f3179a9eff4e8979a433?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmpjMWFjMDMyYzgwMTJmMzE3OWE5ZWZmNGU4OTc5YTQzMyJ9.F3nMy5BtFf6mBfubqLFrNADq7RotYGixv2F4OAd_UxQ&download=image.png "")

公平调度也很关键，多个订阅者的时延会有差异

![](https://tcs.teambition.net/storage/312jd77e0275e6374a66358fd874a0396570?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmpkNzdlMDI3NWU2Mzc0YTY2MzU4ZmQ4NzRhMDM5NjU3MCJ9.8Q7FwBtymotqFthG_yPHZfTQji9gotnqHgCSXBySj3o&download=image.png "")

## N-1场景

high-level sensor fusion [36] in AVs as an example. When data processing is over, sensor fusion techniques are used for the multi-sensor collaboration to correct errors and aggregate results

![](https://tcs.teambition.net/storage/312j60b792e54794bf4d550ad128a4765021?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmo2MGI3OTJlNTQ3OTRiZjRkNTUwYWQxMjhhNDc2NTAyMSJ9.iccvsjCF8K00lLteUDo7qBYYeIbl2T4C4eHrFpoVkCM&download=image.png "")

![](https://tcs.teambition.net/storage/312j0581ca0fe07ed63b99f4eee1eca902d7?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmowNTgxY2EwZmUwN2VkNjNiOTlmNGVlZTFlY2E5MDJkNyJ9.fXyE4S39ct0s0-Mhtzd6fnjDVMJu8sqHtovvS_SPY8w&download=image.png "")

# executor对性能影响

## reference-system-test

基于ros2-tracing 的测试结果

![](https://tcs.teambition.net/storage/312hb8b69b851c3fef29683b018de9703eca?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmhiOGI2OWI4NTFjM2ZlZjI5NjgzYjAxOGRlOTcwM2VjYSJ9.bjGvTHnJ8b3MWksESLwT4BErmC4k8fBhhSKMtwFojo0&download=image.png "")

## cbg对性能影响

- 可缓解死锁现象

- 可以提高回调执行的吞吐量

- cbg结合实时性配置可以增强实时性

Yang Y, Azumi T. Exploring real-time executor on ros 2[C]//2020 IEEE International Conference on Embedded Software and Systems (ICESS). IEEE, 2020: 1-8.

**CBG是做优先级调度的可行路径！**

![](https://tcs.teambition.net/storage/312jeb2b2daee8fd1d3385c5ca380b84e631?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmplYjJiMmRhZWU4ZmQxZDMzODVjNWNhMzgwYjg0ZTYzMSJ9.TRsE846jNLeKA99wKfpiBYkc9McfRWr8JxS7LiVv040&download=image.png "")

# 数据传输方式对性能影响

Intra > SHM > Socket

![](https://tcs.teambition.net/storage/312j6917980c7906e8f20a130778846b55fb?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmo2OTE3OTgwYzc5MDZlOGYyMGExMzA3Nzg4NDZiNTVmYiJ9.cYlxmD70zLfh-DDHEbqhLlDhcfLoTU63H7gTISCh0Iw&download=image.png "")

Intra避免了所有的拷贝，但是有一个没避免，就是Image到sensor_msgs::Image的拷贝，该特性在Humble得到解决

SHM avoids copying data but still requires serialization/deserialization

(1) At present, communication through shared memory is the optimal choice considering both performance and reliability.

(2) Data copy and serializa-tion/deserialization operations are the major sources of communication overhead, the performance penalty from task scheduling is small.

(3) Optimization based on the communica-tion characteristics of different scenarios can bring significant benefits.

(4) The higher the performance of the platform is, the more likely communication becomes the bottleneck.

# 数据传输QoS对性能影响

## History深度

当深度设置比较大时，延迟会增大，因为dds认为延迟的忍受程度会增加

![](https://tcs.teambition.net/storage/312j74467ae49adbfe17734a2fa6aa23a295?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmo3NDQ2N2FlNDlhZGJmZTE3NzM0YTJmYTZhYTIzYTI5NSJ9.sja4z9biUzVr9YcDt8OjcSe5hWxVo-SQXNii6gGnooM&download=image.png "")

## reliability

reliable or best_effort

![](https://tcs.teambition.net/storage/312jf22c38e18f814b9fc80124fd24a2fe9a?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmpmMjJjMzhlMThmODE0YjlmYzgwMTI0ZmQyNGEyZmU5YSJ9.K9KZRPsvGxqySKrBYE_PejXMwBq_n-ItEPvpCcpDzZo&download=image.png "")

## 其他qos

![](https://tcs.teambition.net/storage/312jd8fa3ac0c25aa1ca8ed20c22a3017dc4?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmpkOGZhM2FjMGMyNWFhMWNhOGVkMjBjMjJhMzAxN2RjNCJ9.Ukeps825qG7NZlcbAwwb-hCmex3Rz_V_wve4ArIV1nY&download=image.png "")

# DDS选型对性能影响

## 论文观点：dds选型很重要

![](https://tcs.teambition.net/storage/312jdf52103e5fa041e1f7a49d4055ccbe21?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmpkZjUyMTAzZTVmYTA0MWUxZjdhNDlkNDA1NWNjYmUyMSJ9.V8R67OWNi_-bX13GCbGGGD7CnGESLZVSYW751lzEg9k&download=image.png "")

![](https://tcs.teambition.net/storage/312j9c95d9512555f8b543e4d6c432b904cf?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmo5Yzk1ZDk1MTI1NTVmOGI1NDNlNGQ2YzQzMmI5MDRjZiJ9.Ot38bDU1Bjw-ywLRChGs0WfVhmN4qKE8cWXy7__YA_Y&download=image.png "")

## buildfarm-test

测试了不同网络环境下，数据大小与延迟，丢包率，CPU，内存消耗的测试

cyclonedds比fastdds较优秀

# DDS配置对性能影响

![](https://tcs.teambition.net/storage/312jf64aa3c3818c0415d7778dc313ad33c6?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmpmNjRhYTNjMzgxOGMwNDE1ZDc3NzhkYzMxM2FkMzNjNiJ9.YM0h7KFKohNzlHmudYlPktP_QtbhAonZrCf2VX4n3Tk&download=image.png "")

## 论文观点：延迟强烈依赖dds参数配置

## 论文观点：没有一款dds在所有场景下都做到最好

每个dds都要有特定的配置

fastdds配置策略比较完整

此处坑特别多！

# 工作负载对性能影响

系统资源占用

## 多线程

多线程在降低cpu占用的基础上可以提升性能

## cpu

![](https://tcs.teambition.net/storage/312j648b9085bdd3d948df6de7e7cef5f22e?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmo2NDhiOTA4NWJkZDNkOTQ4ZGY2ZGU3ZTdjZWY1ZjIyZSJ9.HJs5BLLLzMg7rig2l2-FsdHNw3qyrOGYt9FEweZzQlY&download=image.png "")

# 系统资源调度对性能影响

![](https://tcs.teambition.net/storage/312jb9c760e39537b4d72ad8eaf93acfb0dd?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmpiOWM3NjBlMzk1MzdiNGQ3MmFkOGVhZjkzYWNmYjBkZCJ9.GPenMUmyZL4diG_VJPRMHr50poo4fscig5wZ6b_EymM&download=image.png "")

实时配置主要有两个措施：cpu资源隔离和线程优先级配置

![](https://tcs.teambition.net/storage/312j12c4df0806bab32ad16233022c272986?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmoxMmM0ZGYwODA2YmFiMzJhZDE2MjMzMDIyYzI3Mjk4NiJ9.--apRfKqllS0oDhD0-Ps-bKJCYmHYs6ewfBS-KUh9ss&download=image.png "")

## 最佳实践

![](https://tcs.teambition.net/storage/312j942208953d8ef42d8554e7fe81904b70?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmo5NDIyMDg5NTNkOGVmNDJkODU1NGU3ZmU4MTkwNGI3MCJ9._8KtddcrEfyb9ZrYCR5pwGtSj0nSv7js9hOujghej8g&download=image.png "")

## 应用线程实时性配置

rslidar_sdk允许对通信线程配置高的线程优先级，但这个配置默认是关闭的，具体影响未知。

## executor实时性配置

肯定是有影响的，配置实时性比不配置实时性性能要好！

但是得具体问题具体分析！

[**https://github.com/ros2/examples/tree/master/rclcpp/executors/cbg_executor**](https://github.com/ros2/examples/tree/master/rclcpp/executors/cbg_executor)

## ros-realtime-benchmarks

reference-system的测试结果，配置实时性比不配置实时性性能要好！

[**https://ros-realtime.github.io/ros2_realtime_benchmarks/index.html**](https://ros-realtime.github.io/ros2_realtime_benchmarks/index.html)

## DDS线程实时性配置

对DDS线程进行实时性配置

## 实时内核

![](https://tcs.teambition.net/storage/312jf92e03e15182164a6d233d2eb97d3b9a?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmpmOTJlMDNlMTUxODIxNjRhNmQyMzNkMmViOTdkM2I5YSJ9.THaH5Azp_wDSRkoJyyxMt_VX5_jbLu5psQ7OOY31ers&download=image.png "")

![](https://tcs.teambition.net/storage/312j9271b79fcf96e9452ca94874a09c2f22?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmo5MjcxYjc5ZmNmOTZlOTQ1MmNhOTQ4NzRhMDljMmYyMiJ9.FkZNYlmTsyGIiwP6FTfR34VHMq13JTQlvrRnm-_G6Ow&download=image.png "")

# 系统网络协议栈的影响

Linux Network Stack LNS 对于软实时系统是够用的

![](https://tcs.teambition.net/storage/312j4a90d69c05a2663334079cdb917f2d73?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmo0YTkwZDY5YzA1YTI2NjMzMzQwNzljZGI5MTdmMmQ3MyJ9.HkS-ANQrvhTAJCIaOn_oICZQ4ARVTw-pLgBaTv0LbuE&download=image.png "")

# 平台对性能影响

## 平台不同，性能不同

![](https://tcs.teambition.net/storage/312jfa7d6aee0ebf311fbdf0d1a840af511e?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmpmYTdkNmFlZTBlYmYzMTFmYmRmMGQxYTg0MGFmNTExZSJ9.4hEtVrgyCsy3El2jMzyU8OL--pRbxAWqqKT-GY9dbbI&download=image.png "")

## cpu架构对优化措施的敏感程度

![](https://tcs.teambition.net/storage/312jaf004eb428c7f371a2484b578006c59f?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmphZjAwNGViNDI4YzdmMzcxYTI0ODRiNTc4MDA2YzU5ZiJ9.5v879iFY8PWqRsRvUFyNbAMY_adoOPch-We7wKvR6Ws&download=image.png "")

## 通信延迟始终是一个性能瓶颈

![](https://tcs.teambition.net/storage/312j056901aaa2bbcf2a71c28b2d8ff031bd?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmowNTY5MDFhYWEyYmJjZjJhNzFjMjhiMmQ4ZmYwMzFiZCJ9.12npJn0CLbFUFFjF5ud8NzZxnxg-V2ZevCiSlssFL7w&download=image.png "")

## 能源模式的影响

energe-saving mode

![](https://tcs.teambition.net/storage/312jec5be51ada398ab02d71893f4e9bf898?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmplYzViZTUxYWRhMzk4YWIwMmQ3MTg5M2Y0ZTliZjg5OCJ9.dsQbdZxcAJo6Z7Q8eT3GsN7kl6f7i-uuZpjBIe8LsAQ&download=image.png "")

# ROS2能否做到实时？

## **论文观点：能**

![](https://tcs.teambition.net/storage/312jbca8fc46c886a0174cd353d8b2a21286?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTg2MTMxMiwiaWF0IjoxNjcxMjU2NTEyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmpiY2E4ZmM0NmM4ODZhMDE3NGNkMzUzZDhiMmEyMTI4NiJ9.oBDkBQpnjuGMEA3gPMoYw-WuArMeeeubg7PGkQecK8M&download=image.png "")

# 参考文献

Wu T, Wu B, Wang S, et al. Oops! It's Too Late. Your Autonomous Driving System Needs a Faster Middleware[J]. IEEE Robotics and Automation Letters, 2021, 6(4): 7301-7308.

Li Z, Hasegawa A, Azumi T. Autoware_Perf: A tracing and performance analysis framework for ROS 2 applications[J]. Journal of Systems Architecture, 2022, 123: 102341.

Bédard C, Lütkebohle I, Dagenais M. ros2_tracing: Multipurpose Low-Overhead Framework for Real-Time Tracing of ROS 2[J]. IEEE Robotics and Automation Letters, 2022, 7(3): 6511-6518.

Bédard C, Lütkebohle I, Dagenais M. ros2_tracing: Multipurpose Low-Overhead Framework for Real-Time Tracing of ROS 2[J]. IEEE Robotics and Automation Letters, 2022, 7(3): 6511-6518.

Kronauer T, Pohlmann J, Matthé M, et al. Latency analysis of ROS2 multi-node systems[C]//2021 IEEE International Conference on Multisensor Fusion and Integration for Intelligent Systems (MFI). IEEE, 2021: 1-7.

Yang Y, Azumi T. Exploring real-time executor on ros 2[C]//2020 IEEE International Conference on Embedded Software and Systems (ICESS). IEEE, 2020: 1-8.

Choi H, Enright D, Sobhani H, et al. Priority-Driven Real-Time Scheduling in ROS 2: Potential and Challenges[J].
