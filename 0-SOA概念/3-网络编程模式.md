![](https://tcs.teambition.net/storage/31294996fc2a50ed0e8731b1956c7f27ca13?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTYyMDg1OCwiaWF0IjoxNjcxMDE2MDU4LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjk0OTk2ZmMyYTUwZWQwZTg3MzFiMTk1NmM3ZjI3Y2ExMyJ9.TMnHm8zg_v0P8GK72OtmHgbjqCerghjGN06qvKMA7Uo&download=image.png "")

![](https://tcs.teambition.net/storage/312hbea0b50562ca8c172b83501c5d51fa03?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTYyMDg1OCwiaWF0IjoxNjcxMDE2MDU4LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmhiZWEwYjUwNTYyY2E4YzE3MmI4MzUwMWM1ZDUxZmEwMyJ9.l4Hjv7Vvo-QaTMqCgi_McSPpH9t2FwBkTxnT5gN361Q&download=image.png "")

# observer model

观察者模式，主要引入的是回调的概念callback

在观察者模式下，进一步细分，可以分为reactor model和proactor model

# IO多路复用

该功能由操作系统提供，能够处理大量并发事件的通知

一个IO线程就可以同时监听多个fd描述符了，以现代计算机的性能，一个IO线程即可处理几十万数量级别的IO读写。

# reactor pattern

也叫waitset pattern

- 同步模式，用户发出请求后等待，等待读写ready

- 内核启动同步事件多路复用机制，事件发生后，数据在内核缓冲区，此时数据读写ready

- 用户线程执行读写操作

- 用户线程执行回调

# proactor pattern

也叫listener pattern

- 异步模式，用户发出请求后不等待，获取（读写completion）通知之后执行回调

- 内核启动同步事件多路复用机制，事件发生后，系统异步模式完成读写操作，发出读写完成通知，将数据送到用户态

- 此时用户线程执行回调

# 用reactor模拟proactor

asio主要实现了proactor模式，在linux中异步模式并不好用，则采用epoll通过reactor模式来实现proactor

如何实现：在用户层封装一层，模拟内核完成读写操作，发出读写完成通知，用户线程执行回调

ros2 中executor是使用reactor pattern来模拟实现proactor pattern的实现

![](https://tcs.teambition.net/storage/312h7d36af7efe8d9ceeb7f5ca3f62226936?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3MTYyMDg1OCwiaWF0IjoxNjcxMDE2MDU4LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmg3ZDM2YWY3ZWZlOGQ5Y2VlYjdmNWNhM2Y2MjIyNjkzNiJ9.krpl9nIrWQYf1Ys1Bl9SZ1ElrCsM40NXKb49rv6ApFM&download=image.png "")

# 参考

[The Proactor Design Pattern: Concurrency Without Threads - 1.47.0](https://www.boost.org/doc/libs/1_47_0/doc/html/boost_asio/overview/core/async.html)
